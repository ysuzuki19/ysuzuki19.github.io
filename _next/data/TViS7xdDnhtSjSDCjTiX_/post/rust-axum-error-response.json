{"pageProps":{"toc":[{"content":"はじめに","slug":"はじめに","lvl":2,"i":0},{"content":"実装例","slug":"実装例","lvl":2,"i":1},{"content":"おわりに","slug":"おわりに","lvl":2,"i":2},{"content":"参考","slug":"参考","lvl":2,"i":3}],"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    p: \"p\",\n    pre: \"pre\",\n    span: \"span\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.h2, {\n      id: \"はじめに\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#はじめに\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"はじめに\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Rustのコードでよく \", _jsx(_components.a, {\n        href: \"https://docs.rs/thiserror/latest/thiserror/\",\n        children: \"thiserror\"\n      }), \"を使ってErrorの伝搬を楽にしているのだが、 \", _jsx(_components.a, {\n        href: \"https://docs.rs/axum/latest/axum/\",\n        children: \"axum\"\n      }), \"のhandlerでは、\", _jsx(_components.code, {\n        children: \"axum::response::Response\"\n      }), \"そのもの、あるいは、\", _jsx(_components.code, {\n        children: \"axum::response::IntoResponse\"\n      }), \"を実装した型でなければならない。\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"実装例\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#実装例\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"実装例\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"thiserror::Error\"\n      }), \"を実装した型をそのままhandlerのResultには渡せないので、\", _jsx(_components.code, {\n        children: \"axum::response::IntoResponse\"\n      }), \"の実装を行うことで、handlerのResultに渡せるようにする。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"返却するための型（ここでは \", _jsx(_components.code, {\n        children: \"ApiError\"\n      }), \"）は、 \", _jsx(_components.code, {\n        children: \"into_response()\"\n      }), \"内部に書いても構わない。が、 \", _jsx(_components.code, {\n        children: \"serde::Serialize\"\n      }), \"は必要である。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"また、APIのレスポンスに詳細の情報を含めないようにするために、 \", _jsx(_components.code, {\n        children: \"match\"\n      }), \"で分岐するのもよいかもしれない。\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-rust\",\n      children: _jsxs(_components.code, {\n        className: \"language-rust\",\n        children: [_jsx(_components.span, {\n          className: \"token attribute attr-name\",\n          children: \"#[derive(Debug, thiserror::Error)]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"pub\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"enum\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token type-definition class-name\",\n          children: \"AppError\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n    \", _jsxs(_components.span, {\n          className: \"token attribute attr-name\",\n          children: [\"#[error(\", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"Io error: {0}\\\"\"\n          }), \")]\"]\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"Io\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token attribute attr-name\",\n          children: \"#[from]\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"token namespace\",\n          children: [\"std\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          }), \"io\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          })]\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"Error\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n\\n    \", _jsxs(_components.span, {\n          className: \"token attribute attr-name\",\n          children: [\"#[error(\", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"custom error: {0}\\\"\"\n          }), \")]\"]\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"Custom\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"String\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"token attribute attr-name\",\n          children: \"#[derive(serde::Serialize)]\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"pub\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"struct\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token type-definition class-name\",\n          children: \"ApiError\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"pub\"\n        }), \" code\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"u16\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"pub\"\n        }), \" message\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"String\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), \"\\n\\n\\n\", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"impl\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"token namespace\",\n          children: [\"axum\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          }), \"response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          })]\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"IntoResponse\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"for\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"AppError\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"fn\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token function-definition function\",\n          children: \"into_response\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"self\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"->\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"token namespace\",\n          children: [\"axum\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          }), \"response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          })]\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"Response\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"\\n            \", _jsxs(_components.span, {\n          className: \"token namespace\",\n          children: [\"axum\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          }), \"http\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          })]\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"StatusCode\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"::\"\n        }), _jsx(_components.span, {\n          className: \"token constant\",\n          children: \"INTERNAL_SERVER_ERROR\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n            \", _jsxs(_components.span, {\n          className: \"token namespace\",\n          children: [\"axum\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"::\"\n          })]\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"Json\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"ApiError\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n                code\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"500\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n                message\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"self\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token function\",\n          children: \"to_string\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n            \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token function\",\n          children: \"into_response\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"おわりに\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#おわりに\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"おわりに\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"IntoResponse\"\n      }), \"の実装を準備しておくことで、handler実装のResultに直接 \", _jsx(_components.code, {\n        children: \"thiserror\"\n      }), \"実装を渡すことができるようになり、実装を進めるのが楽になる。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"それだけではなく、レスポンスに渡すエラー詳細のマスクを行ったり、エラーの詳細をAPIのレスポンスに含めないようにすること、あるいはClient側でのエラー切り分けが実現できるような基盤を整えることができる。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"utoipa\"\n      }), \"と \", _jsx(_components.code, {\n        children: \"ApiError\"\n      }), \"の連携をしたい場合は、\", _jsx(_components.a, {\n        href: \"/post/rust-axum-utoipa-memo#%E5%85%B1%E9%80%9A%E3%81%AAerror%E5%9E%8B%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B\",\n        children: \"こちら\"\n      }), \"を参照。\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"参考\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#参考\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"参考\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"scope":{"title":"Rustのaxumのhandlerでカスタムエラーを戻り値にする","date":"2025-05-12T00:24:38+09:00","description":"axumのhandlerで、自身で定義したError型をResultで返せるようにします","tags":["rust","axum","tips"]}},"__N_SSG":true}